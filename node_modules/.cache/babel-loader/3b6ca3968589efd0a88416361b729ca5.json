{"ast":null,"code":"import _classCallCheck from\"/home/quinn/Projects/Around-FrontEnd-Amplify/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/quinn/Projects/Around-FrontEnd-Amplify/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/quinn/Projects/Around-FrontEnd-Amplify/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/quinn/Projects/Around-FrontEnd-Amplify/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{Modal,Button,message}from'antd';import{CreatePostForm}from'./CreatePostForm';import{API_ROOT,AUTH_HEADER,TOKEN_KEY,POS_KEY,LOC_SHAKE,TOPIC_AROUND}from'../constants';export var CreatePostButton=/*#__PURE__*/function(_React$Component){_inherits(CreatePostButton,_React$Component);var _super=_createSuper(CreatePostButton);function CreatePostButton(){var _this;_classCallCheck(this,CreatePostButton);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={visible:false,confirmLoading:false};_this.showModal=function(){_this.setState({visible:true});};_this.handleOk=function(){_this.form.validateFields(function(err,values){console.log(values);if(!err){var token=localStorage.getItem(TOKEN_KEY);var _JSON$parse=JSON.parse(localStorage.getItem(POS_KEY)),lat=_JSON$parse.lat,lon=_JSON$parse.lon;var formData=new FormData();formData.set('lat',lat+Math.random()*LOC_SHAKE*2-LOC_SHAKE);formData.set('lon',lon+Math.random()*LOC_SHAKE*2-LOC_SHAKE);formData.set('message',values.message);formData.set('image',values.image[0].originFileObj);_this.setState({confirmLoading:true});fetch(\"\".concat(API_ROOT,\"/post\"),{method:'POST',headers:{Authorization:\"\".concat(AUTH_HEADER,\" \").concat(token)},body:formData}).then(function(response){if(response.ok){return _this.props.loadPostsByTopic();}throw new Error('Failed to create post.');}).then(function(){_this.setState({visible:false,confirmLoading:false});_this.form.resetFields();message.success('Post created successfully!');}).catch(function(e){console.error(e);message.error('Failed to create post.');_this.setState({confirmLoading:false});});}});};_this.handleCancel=function(){console.log('Clicked cancel button');_this.setState({visible:false});};_this.getFormRef=function(formInstance){_this.form=formInstance;};return _this;}_createClass(CreatePostButton,[{key:\"render\",value:function render(){var _this$state=this.state,visible=_this$state.visible,confirmLoading=_this$state.confirmLoading;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Button,{type:\"primary\",onClick:this.showModal},\"Create New Post\"),/*#__PURE__*/React.createElement(Modal,{title:\"Create New Post\",visible:visible,onOk:this.handleOk,okText:\"Create\",confirmLoading:confirmLoading,onCancel:this.handleCancel},/*#__PURE__*/React.createElement(CreatePostForm,{ref:this.getFormRef})));}}]);return CreatePostButton;}(React.Component);","map":{"version":3,"sources":["/home/quinn/Projects/Around-FrontEnd-Amplify/src/components/CreatePostButton.js"],"names":["React","Modal","Button","message","CreatePostForm","API_ROOT","AUTH_HEADER","TOKEN_KEY","POS_KEY","LOC_SHAKE","TOPIC_AROUND","CreatePostButton","state","visible","confirmLoading","showModal","setState","handleOk","form","validateFields","err","values","console","log","token","localStorage","getItem","JSON","parse","lat","lon","formData","FormData","set","Math","random","image","originFileObj","fetch","method","headers","Authorization","body","then","response","ok","props","loadPostsByTopic","Error","resetFields","success","catch","e","error","handleCancel","getFormRef","formInstance","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Modal, Button, message } from 'antd';\nimport { CreatePostForm } from './CreatePostForm';\nimport { API_ROOT, AUTH_HEADER, TOKEN_KEY, POS_KEY, LOC_SHAKE, TOPIC_AROUND } from '../constants';\n\nexport class CreatePostButton extends React.Component {\n  state = {\n    visible: false,\n    confirmLoading: false,\n  };\n\n  showModal = () => {\n    this.setState({\n      visible: true,\n    });\n  };\n\n  handleOk = () => {\n    this.form.validateFields((err, values) => {\n      console.log(values);\n      if (!err) {\n        const token = localStorage.getItem(TOKEN_KEY);\n        const { lat, lon } = JSON.parse(localStorage.getItem(POS_KEY));\n\n        const formData = new FormData();\n        formData.set('lat', lat + Math.random() * LOC_SHAKE * 2 - LOC_SHAKE);\n        formData.set('lon', lon + Math.random() * LOC_SHAKE * 2 - LOC_SHAKE);\n        formData.set('message', values.message);\n        formData.set('image', values.image[0].originFileObj);\n\n        this.setState({ confirmLoading: true });\n        fetch(`${API_ROOT}/post`, {\n          method: 'POST',\n          headers: {\n            Authorization: `${AUTH_HEADER} ${token}`\n          },\n          body: formData,\n        })\n          .then((response) => {\n            if (response.ok) {\n              return this.props.loadPostsByTopic();\n            }\n            throw new Error('Failed to create post.');\n          })\n          .then(() => {\n            this.setState({ visible: false, confirmLoading: false });\n            this.form.resetFields();\n            message.success('Post created successfully!');\n          })\n          .catch((e) => {\n            console.error(e);\n            message.error('Failed to create post.');\n            this.setState({ confirmLoading: false });\n          });\n      }\n    });\n  };\n\n  handleCancel = () => {\n    console.log('Clicked cancel button');\n    this.setState({\n      visible: false,\n    });\n  };\n\n  getFormRef = (formInstance) => {\n    this.form = formInstance;\n  }\n\n  render() {\n    const { visible, confirmLoading } = this.state;\n    return (\n      <div>\n        <Button type=\"primary\" onClick={this.showModal}>\n          Create New Post\n        </Button>\n        <Modal\n          title=\"Create New Post\"\n          visible={visible}\n          onOk={this.handleOk}\n          okText='Create'\n          confirmLoading={confirmLoading}\n          onCancel={this.handleCancel}\n        >\n          <CreatePostForm ref={this.getFormRef}/>\n        </Modal>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}